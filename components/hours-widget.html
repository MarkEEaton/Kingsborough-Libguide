<div id="hours-content-container">
        <div id="hours-content"></div>
        <p>See our <a href="https://library.kbcc.cuny.edu/calendar">hours</a> page for more info.</p>
</div>

<script>

$(document).ready(function(){

$.ajax({
  url: "https://kbcc-cuny.libcal.com/widget/hours/grid?iid=5570&format=json&weeks=1&systemTime=0",
  type: 'GET',
  cache: false,
  dataType: 'jsonp'
})
  .done( function (data) {
    for (i = 0; i < data.locations.length; i++) {
      if (data.locations[i].lid === 16733) {
        for (let key in data.locations[i].weeks[0]) {
          hours = data.locations[i].weeks[0][key]["rendered"];
          let start_and_end = hours.split(" - ");
          let date = new Date(data.locations[i].weeks[0][key]["date"]);
          let today = new Date()
          const isToday = (today.toDateString() == date.toDateString());
          if (isToday) {
            if (start_and_end.length === 1) {
              document.getElementById("hours-content").innerHTML += "The library is <strong>CLOSED</strong> today.<br />"
            } else {
              let start = start_and_end[0];
              let end = start_and_end[1];
              let start_time = parseInt(start.replace(/\D/g, ""));
              let start_ampm = start.slice(-2);
              let end_time = parseInt(end.replace(/\D/g, ""));
              let end_ampm = end.slice(-2);
              let start_24 = start_time;
              let end_24 = end_time;
              if (start_ampm ===  "pm") { start_24 += 12};
              if (end_ampm === "pm") { end_24 += 12};
              console.log("system: " + today.getHours(), "start_24: " + start_24, "end_24: " + end_24);
              let parsed_date = date.toLocaleDateString("en-US", { weekday: 'long', month: 'long', day: 'numeric' });
              if (start_24 <= today.getHours() && today.getHours() < end_24) {
                document.getElementById("hours-content").innerHTML += "The library is currently <strong>OPEN</strong>.<br />Today's hours are <strong>" + hours + "</strong>.<br />"
              } else {
                document.getElementById("hours-content").innerHTML += "The library is currently <strong>CLOSED</strong>.<br />Today's hours are <strong>" + hours + "</strong>.<br />"
              }
            }
          } 
        }   
      }
    }
  })
});

</script>

<style>

#hours-content-container {
       margin-top: -10px;
        text-align: center;
        font-size: 1.7em;
}

</style>
